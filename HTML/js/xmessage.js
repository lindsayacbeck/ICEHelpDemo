/*! Help & Manual WebHelp 3 Script functions
Copyright (c) 2014 - 2015 by Tim Green. All rights reserved. Contact tg@it-authoring.com
*/
function xMsg(i){var b=i+": ";var f=document.domain;if(f!=""){f=location.protocol+"//"+f+(location.port!==""?":"+location.port:"")}else{f="*"}window.returnvalues={};function o(s,q,u){try{var p=typeof s!=="string"?s:s==="parent"?parent:s.indexOf("parent.")===0?parent.frames[s.substr(7)].contentWindow:document.getElementById(s).contentWindow;p.postMessage(q+(u?","+u:""),f)}catch(r){}}function l(r){var q=r;var u=/(.*?)\((.*?|xmsgResult)\){1,1}$|^\w{3,20}/mg,s=u.exec(q);if(s.length>2&&s[2]!==undefined){q=s[1];if(s[2]!==""){var t=s[2].split(",");for(var p=0;p<t.length;p++){q+="|"+t[p]}}else{q+="()"}}return(q)}function n(q){var p=q.split("|"),s=p.shift(),r=p.join();if(r){s=s+"("+r+")"}else{s=s+"()"}return s}function h(q,p,r){if(r&&typeof r==="string"){o(q,"loadTopic,"+p+","+l(r))}else{o(q,"loadTopic,"+p)}}function j(u,s,p){var q=null;var r=0;o(u,"getValue,"+s);if(p&&typeof p==="function"){var t=setInterval(function(){var v=s.replace(/\./g,"_");r++;if(typeof returnvalues[v]!=="undefined"){q=returnvalues[v];delete returnvalues[v];clearInterval(t);p(q);return q}else{if(r>20){clearInterval(t);return"no response"}}},1)}}function g(q,r,p){o(q,"setValue,"+r+"|"+p)}function d(q,r,p){o(q,"returnValue,"+r+"|"+p)}function k(q,p){p=l(p);o(q,"execFunction",p)}function c(s,q){var p=null;switch(s){case"getValue":if(q.indexOf(".")>0){var r=q.split(".");p=window[r[0]][r[1]]?window[r[0]][r[1]]:"null"}else{p=window[q]?window[q]:"null"}return p;break}}function a(p){var q;switch(p){case"true":q=true;break;case"false":q=false;break;case"null":q=null;break;default:q=p}return q}function m(u,t){var p,r,q;function s(){p=u.split("|");r=p.shift();p.forEach(function(x,w,v){if(p[w].indexOf("*")==0){p[w]=p[w].replace(/^\*/,"")}else{if(p[w]==" "){p[w]="''"}else{p[w]="'"+p[w]+"'"}}});p=p.join()}switch(t){case"execlocalfunction":s();q=new Function("if (typeof "+r+" != 'function') return;"+r+"("+p+");");break;case"setlocalvalue":s();q=new Function("if (typeof "+r+" == 'undefined') { console.log('called unknown value: "+r.toString()+"'); return;};"+r+" = "+p);break;case"receivevalue":s();p=a(p);q=new Function("window.returnvalues['"+r+"'] = "+p);break;case"getlocalvalue":r=u;q=new Function("if (typeof "+r+" == 'undefined') return null;if (typeof "+r+" !== 'string') return '*' +"+r+"; else return "+r+";");break}return q}function e(p){p=p||window.event;if(typeof p.data!=="string"){return}var v=document.location.protocol;if(v.substr(0,4)==="http"&&p.origin!=f){return}var u=p.data.split(",");var x=p.source;var w=null;if(u[2]&&u[2]!=="undefined"){w=new Function(n(u[2]))}switch(u[0]){case"loadTopic":History.replaceState(null,null,u[1]);if(w){var r=(u[1].split("?")[0]).replace(/^.*?\.\/(.+$)/ig,"$1");var t=0;var q=setInterval(function(){t++;if(hmFlags.hmCurrentPage===r){clearInterval(q);t=0;w()}if(t>20){clearInterval(q);t=0}},5)}break;case"getValue":var s=m(u[1],"getlocalvalue");d(p.source,u[1].replace(/\./g,"_"),s());break;case"setValue":var s=m(u[1],"setlocalvalue");s();if(w){w()}break;case"returnValue":var s=m(u[1],"receivevalue");s();if(w){w()}break;case"execFunction":var s=n(u[1]);s=new Function(s);s();if(w){w()}break}}if(window.addEventListener){window.addEventListener("message",e,false)}else{(window.attachEvent("onmessage",e))}return{getValue:j,setValue:g,sendMessage:o,loadTopic:h,callFunction:k}};
